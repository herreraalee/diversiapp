<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Ventas DIVERSI</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <!-- PANTALLA DE LOGIN -->
    <div id="loginScreen">
        <div class="login-box">
            <h1>DIVERSI</h1>
            <p>Sistema de gestión de ventas</p>
            <input type="text" id="usernameInput" placeholder="Usuario" autocomplete="username" autofocus>
            <input type="password" id="passwordInput" placeholder="Contraseña" autocomplete="current-password">
            <button id="loginBtn">ENTRAR</button>
            <p id="errorMsg">Usuario o contraseña incorrectos</p>
        </div>
    </div>

    <!-- APP PRINCIPAL -->
    <div id="app">
        <div class="container">
            <h1>Gestión de Ventas DIVERSI</h1>

            <button id="cerrarSesion" style="position:fixed;top:10px;right:10px;z-index:9999;background:#ff0044;color:white;padding:10px;border:none;border-radius:8px;cursor:pointer;">
    Cerrar Sesión
</button>

            <!-- REGISTRAR VENTA -->
            <section class="section">
                <h2>Registrar Venta</h2>
                <form id="ventaForm">
                    <div class="form-grid">
                        <div class="input-group"><label>Nombre del Cliente</label><input type="text" id="cliente" required></div>
                        <div class="input-group"><label>Precio Total Cobrado</label><input type="number" id="precio_total" step="0.01" required></div>
                        <div class="input-group"><label>Tipo de Envío</label>
                            <select id="envioTipo" required>
                                <option value="cargo">Cargo (Q24 + 4% comisión)</option>
                                <option value="mensajeria25">Mensajería Q25</option>
                                <option value="mensajeria30">Mensajería Q30</option>
                                <option value="mensajeria35">Mensajería Q35</option>
                                <option value="mensajeria40">Mensajería Q40</option>
                            </select>
                        </div>
                        <div class="input-group"><label>Guía (opcional)</label><input type="text" id="guia"></div>
                        <div class="input-group"><label>Ganancia Joal</label><input type="number" id="ganancia" step="0.01" value="0"></div>
                        <div class="input-group"><label>Comisión Martin</label><input type="number" id="comision_videos" step="0.01" value="0"></div>
                        <div class="input-group"><label>Comisión Keyla</label><input type="number" id="comision_mensajes" step="0.01" value="0"></div>
                    </div>

                    <h3>Productos</h3>
                    <div id="productosContainer">
                        <div class="producto-item">
                            <div class="input-group"><label>Nombre del producto</label><input type="text" class="producto-nombre" list="productoSuggestions" required></div>
                            <div class="input-group"><label>Costo</label><input type="number" class="producto-costo" step="0.01" required></div>
                        </div>
                    </div>
                    <datalist id="productoSuggestions"></datalist>
                    <button type="button" id="addProductBtn">+ Agregar otro producto</button>

                    <div class="form-actions">
                        <button type="submit">Registrar Venta</button>
                    </div>
                </form>
            </section>

            <!-- HISTORIAL -->
            <section class="section">
                <h2>Historial de Ventas</h2>
                <button id="eliminarTodasBtn" class="delete-all">Eliminar Todas las Ventas</button>
                <button id="exportarBtn" class="export">Exportar a CSV</button>
                <table id="tablaVentas">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Cliente</th>
                            <th>Productos</th>
                            <th>Costo</th>
                            <th>Total Venta</th>
                            <th>Envío</th>
                            <th>Comisión Cargo</th>
                            <th>Ganancia Joal</th>
                            <th>Com. Martin</th>
                            <th>Com. Keyla</th>
                            <th>Ganancia Josue</th>
                            <th>Guía</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </section>

            <!-- TOTALES -->
            <section class="section totals">
                <h2>Totales Acumulados</h2>
                <div class="totals-grid">
                    <div><span>Ventas Totales:</span> <strong id="totalVentas">0.00</strong></div>
                    <div><span>Envíos:</span> <strong id="totalEnvios">0.00</strong></div>
                    <div><span>Comisiones Cargo:</span> <strong id="totalComisiones">0.00</strong></div>
                    <div><span>Ganancia Joal:</span> <strong id="totalGanancias">0.00</strong></div>
                    <div><span>Costos:</span> <strong id="totalCostos">0.00</strong></div>
                    <div><span>Comisión Martin:</span> <strong id="totalComisionVideos">0.00</strong></div>
                    <div><span>Comisión Keyla:</span> <strong id="totalComisionMensajes">0.00</strong></div>
                    <div class="neto-total"><span>Ganancia Josue:</span> <strong id="totalNeto">0.00</strong></div>
                </div>
            </section>

            <!-- GRÁFICA -->
            <section class="section">
                <h2>Productos Más Vendidos</h2>
                <canvas id="productosChart"></canvas>
            </section>

            <!-- INVENTARIO (CORREGIDO: YA NO CIERRA SESIÓN) -->
            <section class="section">
                <h2>Inventario</h2>
                <div class="inventario-input">
                    <input type="text" id="productoNombre" placeholder="Nombre del producto" required>
                    <button type="button" id="btnAgregarInventario">Agregar al Inventario</button>
                </div>
                <table id="tablaInventario">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </section>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>